@model FinancialPortal.ViewModels.BankAccountViewModel
@using FinancialPortal.Enums
@using FinancialPortal.Helpers;
@using Microsoft.AspNet.Identity;
@using Microsoft.AspNet.Identity.EntityFramework;
@using FinancialPortal.Extensions
@using FinancialPortal.Models;


@{
    ViewBag.Title = "Details";
    UserHelper userHelper = new UserHelper();
}


<div class="container">
    <!--begin::Subheader-->
    <div class="subheader py-2 py-lg-6 subheader-solid" id="kt_subheader">
        <div class="container-fluid d-flex align-items-center justify-content-around flex-wrap flex-sm-nowrap">
            <!--begin::Info-->
            <div class="d-flex align-items-center flex-wrap mr-1">
                <!--begin::Page Heading-->
                <div class="d-flex align-items-baseline flex-wrap mr-5">
                    <!--begin::Page Title-->
                    <h5 class="text-dark font-weight-bold my-1 mr-5">Bank Account Details</h5>
                    <!--end::Page Title-->
                </div>
                <!--end::Page Heading-->
            </div>
            <!--end::Info-->
        </div>
    </div>
    <!--end::Subheader-->

    <div class="row">
        <div class="col-xl-6">
            <!--begin::Nav Panel Widget 3-->
            <div class="card card-custom card-stretch gutter-b">
                <!--begin::Body-->
                <div class="card-body">
                    <!--begin::Wrapper-->
                    <div class="d-flex justify-content-between flex-column h-100">
                        <!--begin::Container-->
                        <div class="h-100">
                            <!--begin::Header-->
                            <div class="d-flex flex-column flex-center">
                                <!--begin::Image-->
                                <div class="bgi-no-repeat bgi-size-cover rounded min-h-180px w-100" style="background-image: url('../../assets/media/stock-600x400/img-70.jpg');"></div>
                                <!--end::Image-->
                                <!--begin::Title-->
                                <a class="card-title font-weight-bolder text-dark-75 text-hover-primary font-size-h2 m-0 pt-7 pb-1">@Html.DisplayFor(model => model.BankAccount.AccountName)</a>
                                <!--end::Title-->
                                <!--begin::Text-->
                                <div class="font-weight-bold text-dark-50 font-size-sm pb-7">@User.Identity.GetFullName()</div>
                                <!--end::Text-->
                            </div>
                            <!--end::Header-->
                            <!--begin::Body-->
                            <div class="pt-1">
                                <!--begin::Item-->
                                <div class="d-flex align-items-center pb-9">
                                    <!--begin::Symbol-->
                                    <div class="symbol symbol-45 symbol-light mr-4">
                                        <span class="symbol-label">
                                            <span class="svg-icon svg-icon-2x svg-icon-dark-50">
                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Media/Equalizer.svg-->
                                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <rect x="0" y="0" width="24" height="24" />
                                                        <rect fill="#000000" opacity="0.3" x="13" y="4" width="3" height="16" rx="1.5" />
                                                        <rect fill="#000000" x="8" y="9" width="3" height="11" rx="1.5" />
                                                        <rect fill="#000000" x="18" y="11" width="3" height="9" rx="1.5" />
                                                        <rect fill="#000000" x="3" y="13" width="3" height="7" rx="1.5" />
                                                    </g>
                                                </svg>
                                                <!--end::Svg Icon-->
                                            </span>
                                        </span>
                                    </div>
                                    <!--end::Symbol-->
                                    <!--begin::Text-->
                                    <div class="d-flex flex-column flex-grow-1">
                                        <a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-normal">@Html.DisplayNameFor(model => model.BankAccount.CurrentBalance)</a>
                                        @*<span class="text-muted font-weight-bold">Good Fellas</span>*@
                                    </div>
                                    <!--end::Text-->
                                    <!--begin::label-->
                                    @if (Model.BankAccount.CurrentBalance >= 0)
                                    {
                                        <span class="font-weight-bolder label label-xl label-light-success label-inline px-3 py-5 min-w-45px">
                                            @Html.DisplayFor(model => model.BankAccount.CurrentBalance)
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="font-weight-bolder label label-xl label-light-danger label-inline px-3 py-5 min-w-45px">
                                            @Html.DisplayFor(model => model.BankAccount.CurrentBalance)
                                        </span>
                                    }

                                    <!--end::label-->
                                </div>
                                <!--end::Item-->
                                <!--begin::Item-->
                                <div class="d-flex align-items-center pb-9">
                                    <!--begin::Symbol-->
                                    <div class="symbol symbol-45 symbol-light mr-4">
                                        <span class="symbol-label">
                                            <span class="svg-icon svg-icon-2x svg-icon-dark-50">
                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Communication/Group.svg-->
                                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <polygon points="0 0 24 0 24 24 0 24" />
                                                        <path d="M18,14 C16.3431458,14 15,12.6568542 15,11 C15,9.34314575 16.3431458,8 18,8 C19.6568542,8 21,9.34314575 21,11 C21,12.6568542 19.6568542,14 18,14 Z M9,11 C6.790861,11 5,9.209139 5,7 C5,4.790861 6.790861,3 9,3 C11.209139,3 13,4.790861 13,7 C13,9.209139 11.209139,11 9,11 Z" fill="#000000" fill-rule="nonzero" opacity="0.3" />
                                                        <path d="M17.6011961,15.0006174 C21.0077043,15.0378534 23.7891749,16.7601418 23.9984937,20.4 C24.0069246,20.5466056 23.9984937,21 23.4559499,21 L19.6,21 C19.6,18.7490654 18.8562935,16.6718327 17.6011961,15.0006174 Z M0.00065168429,20.1992055 C0.388258525,15.4265159 4.26191235,13 8.98334134,13 C13.7712164,13 17.7048837,15.2931929 17.9979143,20.2 C18.0095879,20.3954741 17.9979143,21 17.2466999,21 C13.541124,21 8.03472472,21 0.727502227,21 C0.476712155,21 -0.0204617505,20.45918 0.00065168429,20.1992055 Z" fill="#000000" fill-rule="nonzero" />
                                                    </g>
                                                </svg>
                                                <!--end::Svg Icon-->
                                            </span>
                                        </span>
                                    </div>
                                    <!--end::Symbol-->
                                    <!--begin::Text-->
                                    <div class="d-flex flex-column flex-grow-1">
                                        <a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-normal">Monthly Spending</a>
                                        @*<span class="text-muted font-weight-bold">Successful Fellas</span>*@
                                    </div>
                                    <!--end::Text-->
                                    <!--begin::label-->
                                    <span class="font-weight-bolder label label-xl label-light-danger label-inline px-3 py-5 min-w-45px">-$@Html.DisplayFor(model => model.MonthlySpending)</span>
                                    <!--end::label-->
                                </div>
                                <!--end::Item-->
                                <!--begin::Item-->
                                <div class="d-flex align-items-center pb-9">
                                    <!--begin::Symbol-->
                                    <div class="symbol symbol-45 symbol-light mr-4">
                                        <span class="symbol-label">
                                            <span class="svg-icon svg-icon-2x svg-icon-dark-50">
                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Home/Globe.svg-->
                                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <rect x="0" y="0" width="24" height="24" />
                                                        <path d="M13,18.9450712 L13,20 L14,20 C15.1045695,20 16,20.8954305 16,22 L8,22 C8,20.8954305 8.8954305,20 10,20 L11,20 L11,18.9448245 C9.02872877,18.7261967 7.20827378,17.866394 5.79372555,16.5182701 L4.73856106,17.6741866 C4.36621808,18.0820826 3.73370941,18.110904 3.32581341,17.7385611 C2.9179174,17.3662181 2.88909597,16.7337094 3.26143894,16.3258134 L5.04940685,14.367122 C5.46150313,13.9156769 6.17860937,13.9363085 6.56406875,14.4106998 C7.88623094,16.037907 9.86320756,17 12,17 C15.8659932,17 19,13.8659932 19,10 C19,7.73468744 17.9175842,5.65198725 16.1214335,4.34123851 C15.6753081,4.01567657 15.5775721,3.39010038 15.903134,2.94397499 C16.228696,2.49784959 16.8542722,2.4001136 17.3003976,2.72567554 C19.6071362,4.40902808 21,7.08906798 21,10 C21,14.6325537 17.4999505,18.4476269 13,18.9450712 Z" fill="#000000" fill-rule="nonzero" />
                                                        <circle fill="#000000" opacity="0.3" cx="12" cy="10" r="6" />
                                                    </g>
                                                </svg>
                                                <!--end::Svg Icon-->
                                            </span>
                                        </span>
                                    </div>
                                    <!--end::Symbol-->
                                    <!--begin::Text-->
                                    <div class="d-flex flex-column flex-grow-1">
                                        <a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-normal">Monthly Deposits</a>
                                        @*<span class="text-muted font-weight-bold">Successful Fellas</span>*@
                                    </div>
                                    <!--end::Text-->
                                    <!--begin::label-->
                                    <span class="font-weight-bolder label label-xl label-light-success label-inline py-5 min-w-45px">$@Html.DisplayFor(model => model.MonthlyDeposits)</span>
                                    <!--end::label-->
                                </div>
                                <!--end::Item-->
                                <!--begin::Item-->
                                <div class="d-flex align-items-center pb-9">
                                    <!--begin::Symbol-->
                                    <div class="symbol symbol-45 symbol-light mr-4">
                                        <span class="symbol-label">
                                            <span class="svg-icon svg-icon-2x svg-icon-dark-50">
                                                <!--begin::Svg Icon | path:assets/media/svg/icons/Layout/Layout-4-blocks.svg-->
                                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24px" height="24px" viewBox="0 0 24 24" version="1.1">
                                                    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                                        <rect x="0" y="0" width="24" height="24" />
                                                        <rect fill="#000000" x="4" y="4" width="7" height="7" rx="1.5" />
                                                        <path d="M5.5,13 L9.5,13 C10.3284271,13 11,13.6715729 11,14.5 L11,18.5 C11,19.3284271 10.3284271,20 9.5,20 L5.5,20 C4.67157288,20 4,19.3284271 4,18.5 L4,14.5 C4,13.6715729 4.67157288,13 5.5,13 Z M14.5,4 L18.5,4 C19.3284271,4 20,4.67157288 20,5.5 L20,9.5 C20,10.3284271 19.3284271,11 18.5,11 L14.5,11 C13.6715729,11 13,10.3284271 13,9.5 L13,5.5 C13,4.67157288 13.6715729,4 14.5,4 Z M14.5,13 L18.5,13 C19.3284271,13 20,13.6715729 20,14.5 L20,18.5 C20,19.3284271 19.3284271,20 18.5,20 L14.5,20 C13.6715729,20 13,19.3284271 13,18.5 L13,14.5 C13,13.6715729 13.6715729,13 14.5,13 Z" fill="#000000" opacity="0.3" />
                                                    </g>
                                                </svg>
                                                <!--end::Svg Icon-->
                                            </span>
                                        </span>
                                    </div>
                                    <!--end::Symbol-->
                                    <!--begin::Text-->
                                    <div class="d-flex flex-column flex-grow-1">
                                        <a href="#" class="text-dark-75 text-hover-primary mb-1 font-size-lg font-weight-normal">Monthly Transactions</a>
                                        @*<span class="text-muted font-weight-bold">Achievements</span>*@
                                    </div>
                                    <!--end::Text-->
                                    <!--begin::label-->
                                    <span class="font-weight-bolder label label-xl label-light-info label-inline px-3 py-5 min-w-45px">@Html.DisplayFor(model => model.MonthlyTransactions)</span>
                                    <!--end::label-->
                                </div>
                                <!--end::Item-->
                            </div>
                            <!--end::Body-->
                        </div>
                        <!--eng::Container-->
                        <!--begin::Footer-->
                        <div class="row">
                            <div class="col">
                                <div class="d-flex flex-center" id="kt_sticky_toolbar_chat_toggler_2" data-toggle="tooltip" title="" data-placement="right" data-original-title="Create a new budget to allocate money within">
                                    @Html.ActionLink("Create New Budget", "Create", "Budgets", null, new { @id = "buttn2", @class = "btn btn-primary font-weight-bolder font-size-sm py-3 px-14" })
                                </div>
                            </div>
                            <div class="col">
                                <div class="d-flex flex-center" id="kt_sticky_toolbar_chat_toggler_2" data-toggle="tooltip" title="" data-placement="right" data-original-title="Create a new category of savings targets within a budget">
                                    @Html.ActionLink("Create New Category", "Create", "BudgetItems", null, new { @id = "buttn2", @class = "btn btn-primary font-weight-bolder font-size-sm py-3 px-14" })
                                </div>
                            </div>
                        </div>
                        <!--end::Footer-->
                    </div>
                    <!--end::Wrapper-->
                </div>
                <!--end::Body-->
            </div>
            <!--end::Nav Panel Widget 3-->
        </div>
        <div class="col-xl-6">
            <!--begin::Charts Widget 2-->
            <div class="card card-xl-stretch mb-5 mb-xl-8">
                <!--begin::Header-->
                <div class="card-header border-0 pt-5">
                    <h3 class="card-title align-items-start flex-column">
                        <span class="card-label fw-bolder fs-3 mb-1">Transaction History</span>
                        <br />
                        <span class="text-muted fw-bold fs-7">Deposits and Withdrawals</span>
                    </h3>
                    <!--begin::Toolbar-->
                    <div class="card-toolbar" data-kt-buttons="true">
                        <a class="btn btn-sm btn-color-muted btn-active btn-active-primary active px-4 me-1" id="kt_charts_widget_2_year_btn">Year</a>
                        <a class="btn btn-sm btn-color-muted btn-active btn-active-primary px-4 me-1" id="kt_charts_widget_2_month_btn">Month</a>
                        <a class="btn btn-sm btn-color-muted btn-active btn-active-primary px-4" id="kt_charts_widget_2_week_btn">Week</a>
                    </div>
                    <!--end::Toolbar-->
                </div>
                <!--end::Header-->
                <!--begin::Body-->
                <div class="card-body">
                    <!--begin::Chart-->
                    <div id="kt_charts_widget_2_chart" style="height: 350px"></div>
                    <!--end::Chart-->
                </div>
                <!--end::Body-->
            </div>
            <!--end::Charts Widget 2-->
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="small-box elevation-2">

                @using (Html.BeginForm("Create", "Transactions", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("Transaction.AccountId", Model.BankAccount.Id)
                    <br />
                    <div class="row">
                        <div class="col" style="text-align:center">
                            <div class="form-horizontal">
                                <div class="form-group">
                                    <b>Amount</b>
                                    @Html.Label("", htmlAttributes: new { @class = "control-label col-md-2" })
                                    <div class="col">
                                        @Html.EditorFor(model => model.Transaction.Amount, new { htmlAttributes = new { @class = "form-control" } })
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col" style="text-align:center">
                            <div class="form-group">
                                <b>Transaction Type</b>
                                @Html.Label("", htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col">
                                    @Html.EnumDropDownListFor(model => model.Transaction.TransactionType, htmlAttributes: new { @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <div class="col" style="text-align:center">
                            <div class="form-group">
                                <b>Memo</b>
                                @Html.Label("", htmlAttributes: new { @class = "control-label col-md-2" })
                                <div class="col">
                                    @Html.EditorFor(model => model.Transaction.Memo, new { htmlAttributes = new { @class = "form-control" } })
                                </div>
                            </div>
                        </div>
                        <div class="col" style="text-align:center">
                            <div class="form-group">
                                <b>Category</b>
                                <div class="col">
                                    @Html.DropDownListFor(model => model.Transaction.BudgetItemId, Model.BudgetItemId, new { @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <div class="col" style="text-align:center">
                            <div class="form-group">
                                <div class="col">
                                    <input id="button1" type="submit" class="btn" value="ADD TRANSACTION" />
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>



    <div class="row">
        <div class="col">
            <div class="small-box elevation-2">
                <div class="container">
                    <div class="row">
                        @*<div class="col-4">
                                <span style="text-align:center">
                                    <h3 style="color:white"><b>Categories</b></h3>
                                </span>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>
                                                Budget
                                            </th>
                                            <th>
                                                Category
                                            </th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.BankAccount.Transactions.OrderByDescending(c => c.Created))
                                        {
                                            <tr>
                                                @if (item.TransactionType == TransactionType.Withdrawal)
                                                {
                                                    <td style="color:#ff3926">
                                                        [-@item.Amount.ToString("C")]
                                                    </td>
                                                }
                                                else
                                                {
                                                    <td style="color:#84a98c">
                                                        @item.Amount.ToString("C")
                                                    </td>
                                                }
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.BudgetItem.ItemName)
                                                </td>
                                                <td>
                                                    @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                                                    @Html.ActionLink("Delete", "Delete", new { id = item.Id })
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>*@
                        <div class="col">

                            <span style="text-align:center">
                                <h3><b>Transactions</b></h3>
                            </span>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>
                                            Amount
                                        </th>
                                        <th>
                                            Category
                                        </th>
                                        <th>
                                            Memo
                                        </th>
                                        <th>
                                            Date
                                        </th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.BankAccount.Transactions.OrderByDescending(c => c.Created))
                                    {
                                        <tr>
                                            @if (item.TransactionType == TransactionType.Withdrawal)
                                            {
                                                <td style="color:red">
                                                    [-@item.Amount.ToString("C")]
                                                </td>
                                            }
                                            else
                                            {
                                                <td>
                                                    @item.Amount.ToString("C")
                                                </td>
                                            }
                                            <td>
                                                @Html.DisplayFor(modelItem => item.BudgetItem.ItemName)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Memo)
                                            </td>
                                            <td>
                                                @Html.DisplayFor(modelItem => item.Created)
                                            </td>
                                            <td>
                                                @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                                                @Html.ActionLink("Delete", "Delete", new { id = item.Id })
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
@*<div>
        <dl class="dl-horizontal">
                <dt>
                    @Html.DisplayNameFor(model => model.Household.HouseholdName)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Household.HouseholdName)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.Owner.FirstName)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Owner.FirstName)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.AccountName)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.AccountName)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.Created)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.Created)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.StartingBalance)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.StartingBalance)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.CurrentBalance)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.CurrentBalance)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.WarningBalance)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.WarningBalance)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.IsDeleted)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.IsDeleted)
                </dd>

                <dt>
                    @Html.DisplayNameFor(model => model.AccountType)
                </dt>

                <dd>
                    @Html.DisplayFor(model => model.AccountType)
                </dd>

            </dl>
    </div>*@
@*<p>
        @Html.ActionLink("Edit", "Edit", new { id = Model.Id }) |
        @Html.ActionLink("Back to List", "Index")
    </p>*@
